<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>üïâÔ∏è Jaap Counter</title>
  <style>
    :root {
      --bg: #ffffff;
      --text: #000000;
      --button: #f0f0f0;
      --accent: #4caf50;
    }

    [data-theme='dark'] {
      --bg: #121212;
      --text: #ffffff;
      --button: #1f1f1f;
      --accent: #81c784;
    }

    body {
      background-color: var(--bg);
      color: var(--text);
      font-family: 'Segoe UI', sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      margin: 0;
      padding: 20px;
      text-align: center;
      transition: background-color 0.3s ease, color 0.3s ease;
    }

    .theme-toggle {
      position: absolute;
      top: 15px;
      right: 15px;
      background: none;
      border: none;
      font-size: 1.8rem;
      cursor: pointer;
      color: var(--text);
    }

    h1 {
      margin-bottom: 10px;
    }

    #counterDisplay {
      font-size: 2.5rem;
      margin: 20px 0;
    }

    .button-container {
      position: relative;
      width: 180px;
      height: 180px;
    }

    .tap-btn {
      width: 100%;
      height: 100%;
      border-radius: 50%;
      font-size: 1.4rem;
      font-weight: bold;
      background-color: var(--accent);
      color: white;
      border: none;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
      cursor: pointer;
      transition: transform 0.2s ease, background-color 0.3s ease;
      position: relative; /* Position relative for the progress circle */
      z-index: 1; /* Ensure the button is above the progress circle */
    }

    .tap-btn:active {
      transform: scale(0.96);
    }

    .tap-btn:hover {
      background-color: darkgreen; /* Darker shade for hover effect */
    }

    .circular-progress {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      border-radius: 50%;
      overflow: hidden;
      z-index: 0; /* Behind the button */
    }

    .circular-progress svg {
      transform: rotate(-90deg);
      width: 100%;
      height: 100%;
    }

    .circular-progress circle {
      fill: none;
      stroke-width: 10;
    }

    .circular-progress .background {
      stroke: #e6e6e6;
    }

    .circular-progress .progress {
      stroke: var(--accent);
      transition: stroke-dashoffset 0.5s ease;
    }

    .btn {
      padding: 12px 25px;
      margin: 10px;
      font-size: 1rem;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      background-color: var(--button);
      color: var(--text);
      transition: background-color 0.3s ease;
    }

    .btn:hover {
      background-color: var(--accent);
      color: #fff;
    }

    input {
      padding: 10px;
      font-size: 1rem;
      border-radius: 8px;
      border: 1px solid #aaa;
      width: 180px;
      text-align: center;
    }

    #timer {
      margin-top: 10px;
      font-size: 1rem;
      color: gray;
    }

    #animatedMantra {
      margin-top: 15px;
      font-size: 1.2rem;
      font-weight: bold;
      animation: pulse 2s infinite;
      color: var(--accent);
    }

    @keyframes pulse {
      0% { opacity: 0.3; }
      50% { opacity: 1; }
      100% { opacity: 0.3; }
    }

    #player {
      margin-top: 10px;
      display: block; /* Ensure the player is displayed */
      width: 320px; /* Smaller width for the video player */
      height: 180px; /* Smaller height for the video player */
    }
  </style>
</head>
<body>

  <button class="theme-toggle" onclick="toggleTheme()">üåû</button>

  <h1>üïâÔ∏è Jaap Counter</h1>
  <div id="counterDisplay">0 / 108</div>
  
  <!-- Button with Circular Progress -->
  <div class="button-container">
    <div class="circular-progress">
      <svg>
        <circle class="background" cx="90" cy="90" r="70"></circle>
        <circle class="progress" cx="90" cy="90" r="70"></circle>
      </svg>
    </div>
    <button class="tap-btn" onclick="incrementCounter()">Tap (Jaap)</button>
  </div>

  <br/>
  
  <input type="number" id="targetInput" placeholder="Set Target" onchange="setTarget()"/>
  <button class="btn" onclick="resetCounter()">Reset</button>
  <div id="timer">Time: 00:00</div>

  <div id="animatedMantra">‡•ê ‡§®‡§Æ‡§É ‡§∂‡§ø‡§µ‡§æ‡§Ø</div>
  
  <input type="text" id="videoUrlInput" placeholder="Paste YouTube Mantra URL"/>
  <button class="btn" onclick="loadVideo()">Play Mantra</button>

  <div id="player"></div>

  <div class="controls">
    <button class="btn" onclick="togglePlayPause()">‚èØÔ∏è Play/Pause</button>
    <label>
      üîä Volume:
      <input type="range" min="0" max="100" value="100" onchange="setVolume(this.value)">
    </label>
  </div>

  <script>
    let count = 0;
    let target = 108;
    let startTime = null;
    let timerInterval = null;
    let player;
    let isPlaying = false;

    const display = document.getElementById('counterDisplay');
    const timer = document.getElementById('timer');
    const progressCircle = document.querySelector('.progress');
    const radius = 70; // Radius of the circle
    const circumference = 2 * Math.PI * radius; // Circumference of the circle

    // Set the stroke dasharray and dashoffset for the progress circle
    progressCircle.style.strokeDasharray = circumference;
    progressCircle.style.strokeDashoffset = circumference;

    function incrementCounter() {
      console.log(`Current count: ${count}, Target: ${target}`);
      if (count === 0) startTimer();

      if (count < target) {
        count++;
        updateDisplay();
        updateProgress();
        if (count === target) {
          stopTimer();
          alert(`üéâ Jaap Complete in ${timer.textContent.split(': ')[1]}!`);
        }
      }
    }

    function updateDisplay() {
      display.textContent = `${count} / ${target}`;
    }

    function updateProgress() {
      const offset = circumference - (count / target) * circumference;
      progressCircle.style.strokeDashoffset = offset;
    }

    function setTarget() {
      const input = document.getElementById('targetInput').value;
      target = input > 0 ? parseInt(input) : 108;
      count = 0;
      resetTimer();
      updateDisplay();
      updateProgress(); // Update progress when target is set
    }

    function resetCounter() {
      count = 0;
      updateDisplay();
      resetTimer();
      updateProgress(); // Reset progress
    }

    function startTimer() {
      startTime = new Date();
      timerInterval = setInterval(() => {
        const now = new Date();
        const diff = Math.floor((now - startTime) / 1000);
        const mins = String(Math.floor(diff / 60)).padStart(2, '0');
        const secs = String(diff % 60).padStart(2, '0');
        timer.textContent = `Time: ${mins}:${secs}`;
      }, 1000);
    }

    function stopTimer() {
      clearInterval(timerInterval);
    }

    function resetTimer() {
      stopTimer();
      timer.textContent = 'Time: 00:00';
      startTime = null;
    }

    // YouTube Player API
    function loadVideo() {
      const videoUrl = document.getElementById('videoUrlInput').value;
      const videoId = extractVideoIdFromUrl(videoUrl);

      if (player) {
        player.loadVideoById(videoId);
      } else {
        player = new YT.Player('player', {
          height: '180', // Smaller height for the video player
          width: '320',  // Smaller width for the video player
          videoId: videoId,
          events: {
            'onReady': onPlayerReady,
            'onStateChange': onPlayerStateChange
          }
        });
      }
    }

    function extractVideoIdFromUrl(url) {
      const match = url.match(/(?:youtu\.be\/|v=|embed\/|watch\?v=)([^&]+)/);
      return match ? match[1] : '';
    }

    function onPlayerReady(event) {
      event.target.setVolume(100);
      event.target.playVideo();
      isPlaying = true;
    }

    function onPlayerStateChange(event) {
      if (event.data === 1) { // playing
        isPlaying = true;
      } else if (event.data === 2) { // paused
        isPlaying = false;
      } else if (event.data === 0) { // ended
        isPlaying = false;
      }
    }

    function togglePlayPause() {
      if (player) {
        if (isPlaying) {
          player.pauseVideo();
        } else {
          player.playVideo();
        }
      }
    }

    function setVolume(vol) {
      if (player) {
        player.setVolume(vol);
      }
    }

    // Theme toggle
    let dark = false;
    function toggleTheme() {
      dark = !dark;
      document.documentElement.setAttribute('data-theme', dark ? 'dark' : 'light');
      document.querySelector('.theme-toggle').textContent = dark ? 'üåô' : 'üåû';
    }

    // Initial Display
    updateDisplay();
    updateProgress(); // Initialize progress
  </script>
  <script src="https://www.youtube.com/iframe_api"></script>
</body>
</html>
